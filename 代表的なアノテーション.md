# 代表的なアノテーション

DIを学んだ際に、`@Autowired`という記述が出てきました。
そういえば今まで、よくわからないまま使っていた`@Controller`や`@Service`などをとりあえずで記述していましたね？
この`@`がついているものをアノテーションといいます。これをつけることで、何ができるようになるのでしょうか？

その正体を探るために、いったん今まで作っていたコードから、この記述を削除してみましょう。

## @Controllerを外してみる
```diff
- @Controller
public class DisplayNumController {
    
    @Autowired
    private RandNumService randNumService;

    @GetMapping("/home")
    public String home(Model model){
        int randNum = randNumService.getRandNum();
        model.addAttribute("num", randNum);
        return "home";
    }
}
```
こんな形で`@Controller`を外して、いつも通りSpringBootを起動してみましょう。
いつも通り`http://localhost:8080/home`にアクセスしてみると...

![404エラーページ](image.png)

アクセスできなくなってしまいました。原因は404エラー、つまりページが見つからなくなってしまったようです。

## @Serviceを外してみる
```diff
- @Service
public class RandNumService {
    
    public int getRandNum(){
        return (int)(Math.random() * 100);
    }
}
```

次にいったんコントローラの記述は元に戻して、サービスの`@Service`を外してみました。すると...

![Not Foundエラー](image-1.png)

なんとSpring Boot自体が起動しなくてなってしまいました。エラーを見ると、`RandNumService`がnot be found、つまりクラス自体が見つからなかったみたいです。また`Autowired`も関わっていそうですね。

## 改めて、アノテーションとは？
`@Controller`や`@Service`などのアノテーションは、これをつけるとDIコンテナで認識されるようになる、つまりSpring Boot側で自動管理されるクラスとして扱われるようになります。
また`@Autowired`は少し別の意味があり、これがつけられた変数に関しては、自動的にDIコンテナに登録されているクラスから注入が起こるようになります。
この前提で、先ほどそれぞれを外したときになぜエラーが起こってしまったのか、処理を追ってみましょう。

### @Controllerを外した場合
この場合、Spring Bootの起動時のエラーは発生しませんが、ブラウザでURLを入力するとNotFoundのエラーが起こります。

~~ Controllerアクセスの画像 ~~

画像にある通り、実は`@Controller`をつけたクラスの中にある`@GetMapping`などで指定されたURLしか、SpringBootは認識してくれません。よく考えれば、SpringBootが起動したタイミングで、どのパスをコントローラのクラスはすべて最初からSpringBootが認識できる状態でないとブラウザからアクセスできませんよね？
`@Controller`をつけて初めて、Springboot起動時にコントローラクラスとして認識され、そのパスにアクセスしたときに該当の処理を行うような流れになっています。

### @Serviceを外した場合
この場合、先ほどのControllerのようにURLが見つからなくなる、みたいなことは起こりません。ただし、このControllerをDIコンテナから使おうとするときに問題が発生します。

~~ DIコンテナから起動するときの問題の画像 ~~

画像にある通り、Controllerを利用するときに、`@Autowired`がついているクラス`RandNumService`をDIコンテナ内から探そうとします。ただし、このクラスには`@Service`がついていないせいでDIコンテナに登録されていないせいで、DIコンテナが注入を行おうとしてもクラスが見つかりません。そのせいで、先ほどのエラーであるnot be foundが出てきてしまいます。

### 演習：アノテーションとDIについて
- @Serviceをつけなくても、コントローラの記述を一部変更すれば実は正常に動作するようになります。どうすればいいか考えてみましょう。

## 代表的なアノテーション
今まで説明した通り、アノテーションはDIコンテナで管理するため（=Sprin Bootが認識できるようにするため）に使われます。いくつか種類や使い分けがあるので、代表的なものをここで紹介します。すべてを覚える必要はありませんが、いざ使いたいときに思い出せるように、ここで一通り学んでおきましょう。

### ステレオタイプアノテーション
SpringBootのDIコンテナに、特定の役割があると認識させるために使うアノテーションです。使用頻度が高いものが多いです。
- @Controller
コントローラクラス用のアノテーションです。DIコンテナに登録されるだけでなく、上で説明したようなパスの設定なども読み込んでくれるようになります。

- @Service
サービスクラス用のアノテーションです。実はDIコンテナに登録される以外の機能は特にないです。Serviceクラスはほぼ必ずと言っていいほどSpringBootでの作成に使うので、見たときにわかりやすいためにつける意味もあるようです。

- @Repository
データベースにアクセスするクラス用のアノテーションです。まだRepositoryについて詳しく説明していないのでそこだけを理解すればよいですが、データベース関係の例外処理をうまくSpringBootで扱えるようにしてくれる機能もあります。

- @Component
上の3つ以外のクラスをDIコンテナに登録したい場合に使うアノテーション。DIコンテナに登録される以外の特別な機能はありません。上以外のクラスで`Autowired`を使ってDIしたいものがあるときなどに利用します。

### それ以外のアノテーション
それ以外にも様々なアノテーションがあります。いったんここでは3つ紹介しますが、Java応用で扱うアノテーションもあるのでここでは概要だけわかれば大丈夫です。
- @Autowired
DIコンテナ内にあるクラスから依存関係を自動的に注入するためのアノテーションです。今まで見てきた通り、これがついているとコード側でインスタンス化をすることなく、Springboot側で勝手に該当クラスを探して、インスタンス化を行ってくれるようになります。

- @Transactional
データベース関係のアノテーションです。これをつけることで、トランザクション管理というものをしてくれるようになります。詳しくはDB研修およびJava応用研修で。

- @Value
application.propertiesにある設定値を呼び出すことができます。application.propertiesはSpringBoot全体で使うようなDB関係の設定、ログの設定などを行うことができますが、このアノテーションを使うことで具体的な値を利用してコード上で使うこともできます。詳しくはJava応用研修で。

### 演習：